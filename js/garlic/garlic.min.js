!function(c){var b=function(d){this.defined="undefined"!==typeof localStorage};b.prototype={constructor:b,get:function(d,e){return localStorage.getItem(d)?localStorage.getItem(d):"undefined"!==typeof e?e:null},has:function(d){return localStorage.getItem(d)?true:false},set:function(d,f,e){if("string"===typeof f){if(""===f){this.destroy(d)}else{localStorage.setItem(d,f)}}return"function"===typeof e?e():true},destroy:function(d,e){localStorage.removeItem(d);return"function"===typeof e?e():true},clean:function(e){for(var d=localStorage.length-1;d>=0;d--){if("undefined"===typeof Array.indexOf&&-1!==localStorage.key(d).indexOf("garlic:")){localStorage.removeItem(localStorage.key(d))}}return"function"===typeof e?e():true},clear:function(d){localStorage.clear();return"function"===typeof d?d():true}};var a=function(e,f,d){this.init("garlic",e,f,d)};a.prototype={constructor:a,init:function(f,e,g,d){this.type=f;this.$element=c(e);this.options=this.getOptions(d);this.storage=g;this.path=this.getPath();this.parentForm=this.$element.closest("form");this.$element.addClass("garlic-auto-save");this.expiresFlag=!this.options.expires?false:(this.$element.data("expires")?this.path:this.getPath(this.parentForm))+"_flag";this.$element.on(this.options.events.join("."+this.type+" "),false,c.proxy(this.persist,this));if(this.options.destroy){c(this.parentForm).on("submit reset",false,c.proxy(this.destroy,this))}this.retrieve()},getOptions:function(d){d=c.extend({},c.fn[this.type].defaults,d,this.$element.data());return d},persist:function(){if(this.val===this.$element.val()){return}this.val=this.$element.val();if(this.options.expires){this.storage.set(this.expiresFlag,(new Date().getTime()+this.options.expires*1000).toString())}if(this.$element.is("input[type=checkbox]")){return this.storage.set(this.path,this.$element.attr("checked")?"checked":"unchecked")}this.storage.set(this.path,this.$element.val())},retrieve:function(){if(this.storage.has(this.path)){if(this.options.expires){var d=new Date().getTime();if(this.storage.get(this.expiresFlag)<d.toString()){this.storage.destroy(this.path);return}else{this.$element.attr("expires-in",Math.floor((parseInt(this.storage.get(this.expiresFlag))-d)/1000))}}var e=this.storage.get(this.path);if(this.options.conflictManager.enabled&&this.detectConflict()){return this.conflictManager()}if(this.$element.is("input[type=radio], input[type=checkbox]")){if("checked"===e||this.$element.val()===e){return this.$element.attr("checked",true)}else{if("unchecked"===e){this.$element.attr("checked",false)}}return}this.$element.val(e);this.options.onRetrieve(this.$element,e);return}},detectConflict:function(){var d=this;if(this.$element.is("input[type=checkbox], input[type=radio]")){return false}if(this.$element.val()&&this.storage.get(this.path)!==this.$element.val()){if(this.$element.is("select")){var e=false;this.$element.find("option").each(function(){if(c(this).index()!==0&&c(this).attr("selected")&&c(this).val()!==d.storage.get(this.path)){e=true;return}});return e}return true}return false},conflictManager:function(){if("function"===typeof this.options.conflictManager.onConflictDetected&&!this.options.conflictManager.onConflictDetected(this.$element,this.storage.get(this.path))){return false}if(this.options.conflictManager.garlicPriority){this.$element.data("swap-data",this.$element.val());this.$element.data("swap-state","garlic");this.$element.val(this.storage.get(this.path))}else{this.$element.data("swap-data",this.storage.get(this.path));this.$element.data("swap-state","default")}this.swapHandler();this.$element.addClass("garlic-conflict-detected");this.$element.closest("input[type=submit]").attr("disabled",true)},swapHandler:function(){var d=c(this.options.conflictManager.template);this.$element.after(d.text(this.options.conflictManager.message));d.on("click",false,c.proxy(this.swap,this))},swap:function(){var d=this.$element.data("swap-data");this.$element.data("swap-state","garlic"===this.$element.data("swap-state")?"default":"garlic");this.$element.data("swap-data",this.$element.val());c(this.$element).val(d)},destroy:function(){this.storage.destroy(this.path)},remove:function(){this.remove();if(this.$element.is("input[type=radio], input[type=checkbox]")){c(this.$element).attr("checked",false);return}this.$element.val("")},getPath:function(i){if("undefined"===typeof i){i=this.$element}if(i.length!=1){return false}var j="",e=i.is("input[type=checkbox]"),h=i;while(h.length){var g=h[0],d=g.nodeName;if(!d){break}d=d.toLowerCase();var f=h.parent(),k=f.children(d);if(!c(g).is("form, input, select, textarea")&&!e){h=f;continue}d+=c(g).attr("name")?"."+c(g).attr("name"):"";if(k.length>1&&!c(g).is("input[type=radio]")){d+=":eq("+k.index(g)+")"}j=d+(j?">"+j:"");if("form"==g.nodeName.toLowerCase()){break}h=f}return"garlic:"+document.domain+(this.options.domain?"*":window.location.pathname)+">"+j},getStorage:function(){return this.storage}};c.fn.garlic=function(g,f){var d=c.extend(true,{},c.fn.garlic.defaults,g,this.data()),i=new b(),e=false;if(!i.defined){return false}function h(j){var m=c(j),l=m.data("garlic"),k=c.extend({},d,m.data());if("undefined"!==typeof k.storage&&!k.storage){return}if(!l){m.data("garlic",(l=new a(j,i,k)))}if("string"===typeof g&&"function"===typeof l[g]){return l[g]()}}this.each(function(){if(c(this).is("form")){c(this).find(d.inputs).each(function(){e=h(c(this))})}else{if(c(this).is(d.inputs)){e=h(c(this))}}});return"function"===typeof f?f():e};c.fn.garlic.Constructor=a;c.fn.garlic.defaults={destroy:true,inputs:"input, textarea, select",events:["DOMAttrModified","textInput","input","change","keypress","paste","focus"],domain:false,expires:false,conflictManager:{enabled:true,garlicPriority:true,template:'<span class="garlic-swap"></span>',message:"This is your saved data. Click here to see default one",onConflictDetected:function(e,d){return true}},onRetrieve:function(e,d){}};c(window).on("load",function(){c('[data-persist="garlic"]').each(function(){c(this).garlic()})})}(window.jQuery||window.Zepto);
