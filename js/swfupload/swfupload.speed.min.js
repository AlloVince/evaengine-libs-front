var SWFUpload;if(typeof(SWFUpload)==="function"){SWFUpload.speed={};SWFUpload.prototype.initSettings=(function(a){return function(b){if(typeof(a)==="function"){a.call(this,b)}this.ensureDefault=function(d,c){this.settings[d]=(b[d]==undefined)?c:b[d]};this.fileSpeedStats={};this.speedSettings={};this.ensureDefault("moving_average_history_size","10");this.speedSettings.user_file_queued_handler=this.settings.file_queued_handler;this.speedSettings.user_file_queue_error_handler=this.settings.file_queue_error_handler;this.speedSettings.user_upload_start_handler=this.settings.upload_start_handler;this.speedSettings.user_upload_error_handler=this.settings.upload_error_handler;this.speedSettings.user_upload_progress_handler=this.settings.upload_progress_handler;this.speedSettings.user_upload_success_handler=this.settings.upload_success_handler;this.speedSettings.user_upload_complete_handler=this.settings.upload_complete_handler;this.settings.file_queued_handler=SWFUpload.speed.fileQueuedHandler;this.settings.file_queue_error_handler=SWFUpload.speed.fileQueueErrorHandler;this.settings.upload_start_handler=SWFUpload.speed.uploadStartHandler;this.settings.upload_error_handler=SWFUpload.speed.uploadErrorHandler;this.settings.upload_progress_handler=SWFUpload.speed.uploadProgressHandler;this.settings.upload_success_handler=SWFUpload.speed.uploadSuccessHandler;this.settings.upload_complete_handler=SWFUpload.speed.uploadCompleteHandler;delete this.ensureDefault}})(SWFUpload.prototype.initSettings);SWFUpload.speed.fileQueuedHandler=function(a){if(typeof this.speedSettings.user_file_queued_handler==="function"){a=SWFUpload.speed.extendFile(a);return this.speedSettings.user_file_queued_handler.call(this,a)}};SWFUpload.speed.fileQueueErrorHandler=function(a,c,b){if(typeof this.speedSettings.user_file_queue_error_handler==="function"){a=SWFUpload.speed.extendFile(a);return this.speedSettings.user_file_queue_error_handler.call(this,a,c,b)}};SWFUpload.speed.uploadStartHandler=function(a){if(typeof this.speedSettings.user_upload_start_handler==="function"){a=SWFUpload.speed.extendFile(a,this.fileSpeedStats);return this.speedSettings.user_upload_start_handler.call(this,a)}};SWFUpload.speed.uploadErrorHandler=function(a,c,b){a=SWFUpload.speed.extendFile(a,this.fileSpeedStats);SWFUpload.speed.removeTracking(a,this.fileSpeedStats);if(typeof this.speedSettings.user_upload_error_handler==="function"){return this.speedSettings.user_upload_error_handler.call(this,a,c,b)}};SWFUpload.speed.uploadProgressHandler=function(a,c,b){this.updateTracking(a,c);a=SWFUpload.speed.extendFile(a,this.fileSpeedStats);if(typeof this.speedSettings.user_upload_progress_handler==="function"){return this.speedSettings.user_upload_progress_handler.call(this,a,c,b)}};SWFUpload.speed.uploadSuccessHandler=function(b,a){if(typeof this.speedSettings.user_upload_success_handler==="function"){b=SWFUpload.speed.extendFile(b,this.fileSpeedStats);return this.speedSettings.user_upload_success_handler.call(this,b,a)}};SWFUpload.speed.uploadCompleteHandler=function(a){a=SWFUpload.speed.extendFile(a,this.fileSpeedStats);SWFUpload.speed.removeTracking(a,this.fileSpeedStats);if(typeof this.speedSettings.user_upload_complete_handler==="function"){return this.speedSettings.user_upload_complete_handler.call(this,a)}};SWFUpload.speed.extendFile=function(b,a){var c;if(!b){return b}if(a){c=a[b.id]}if(c){b.currentSpeed=c.currentSpeed;b.averageSpeed=c.averageSpeed;b.movingAverageSpeed=c.movingAverageSpeed;b.timeRemaining=c.timeRemaining;b.timeElapsed=c.timeElapsed;b.percentUploaded=c.percentUploaded;b.sizeUploaded=c.bytesUploaded}else{b.currentSpeed=0;b.averageSpeed=0;b.movingAverageSpeed=0;b.timeRemaining=0;b.timeElapsed=0;b.percentUploaded=0;b.sizeUploaded=0}return b};SWFUpload.prototype.updateTracking=function(d,g){var f=this.fileSpeedStats[d.id];if(!f){this.fileSpeedStats[d.id]=f={}}g=g||f.bytesUploaded||0;if(g<0){g=0}if(g>d.size){g=d.size}var h=(new Date()).getTime();if(!f.startTime){f.startTime=(new Date()).getTime();f.lastTime=f.startTime;f.currentSpeed=0;f.averageSpeed=0;f.movingAverageSpeed=0;f.movingAverageHistory=[];f.timeRemaining=0;f.timeElapsed=0;f.percentUploaded=g/d.size;f.bytesUploaded=g}else{if(f.startTime>h){this.debug("When backwards in time")}else{var c=(new Date()).getTime();var e=f.lastTime;var b=c-e;var a=g-f.bytesUploaded;if(a===0||b===0){return f}f.lastTime=c;f.bytesUploaded=g;f.currentSpeed=(a*8)/(b/1000);f.averageSpeed=(f.bytesUploaded*8)/((c-f.startTime)/1000);f.movingAverageHistory.push(f.currentSpeed);if(f.movingAverageHistory.length>this.settings.moving_average_history_size){f.movingAverageHistory.shift()}f.movingAverageSpeed=SWFUpload.speed.calculateMovingAverage(f.movingAverageHistory);f.timeRemaining=(d.size-f.bytesUploaded)*8/f.movingAverageSpeed;f.timeElapsed=(c-f.startTime)/1000;f.percentUploaded=(f.bytesUploaded/d.size*100)}}return f};SWFUpload.speed.removeTracking=function(c,a){try{a[c.id]=null;delete a[c.id]}catch(b){}};SWFUpload.speed.formatUnits=function(g,c,b,h){var d,f,a,k;if(g===0){return"0 "+b[b.length-1]}if(h){f=g;k=b.length>=c.length?b[c.length-1]:"";for(d=0;d<c.length;d++){if(g>=c[d]){f=(g/c[d]).toFixed(2);k=b.length>=d?" "+b[d]:"";break}}return f+k}else{var e=[];var j=g;for(d=0;d<c.length;d++){a=c[d];k=b.length>d?" "+b[d]:"";f=j/a;if(d<c.length-1){f=Math.floor(f)}else{f=f.toFixed(2)}if(f>0){j=j%a;e.push(f+k)}}return e.join(" ")}};SWFUpload.speed.formatBPS=function(b){var c=[1073741824,1048576,1024,1],a=["Gbps","Mbps","Kbps","bps"];return SWFUpload.speed.formatUnits(b,c,a,true)};SWFUpload.speed.formatTime=function(c){var a=[86400,3600,60,1],b=["d","h","m","s"];return SWFUpload.speed.formatUnits(c,a,b,false)};SWFUpload.speed.formatBytes=function(c){var b=[1073741824,1048576,1024,1],a=["GB","MB","KB","bytes"];return SWFUpload.speed.formatUnits(c,b,a,true)};SWFUpload.speed.formatPercent=function(a){return a.toFixed(2)+" %"};SWFUpload.speed.calculateMovingAverage=function(h){var j=[],l,g=0,m=0,e=0,b=0,d=0;var f;var c=0,k=0;l=h.length;if(l>=8){for(f=0;f<l;f++){j[f]=h[f];g+=j[f]}m=g/l;for(f=0;f<l;f++){e+=Math.pow((j[f]-m),2)}b=e/l;d=Math.sqrt(b);for(f=0;f<l;f++){j[f]=(j[f]-m)/d}var a=2;for(f=0;f<l;f++){if(j[f]<=a&&j[f]>=-a){k++;c+=h[f]}}}else{k=l;for(f=0;f<l;f++){c+=h[f]}}return c/k}};
